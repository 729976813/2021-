## 1. 进程概念

本节主要解决进程的基本定义特点。

1.定义：进程是进程实体的运行过程，是系统分配资源和调度的**独立单位**。进程是程序数据(具有一定功能的程序和数据集合)在CPU上的一次执行过程。

为什么要提出进程：引入进程是为了更好的描述和控制程序的并发执行，满足操作系统的并发性和共享性。

2.特征：

动态：进程的实质是程序的一次执行过程，是动态产生和消亡的

并发：任何进程可以和其他进程并发执行。

独立：进程是独立运行的基本单位，是系统分配资源和调度资源的独立单位。

异步：进程执行具有间断性，进程按照各自独立的、不可预知的速度向前推进

结构：进程由程序、数据和进程控制块三部分组成。不同进程可以包含相同的程序，不同的数据集合可以产生不同的运行结果。



3.进程实体：什么是进程实体？由程序、数据和PCB（进程控制块）组成。



残留疑问：

1.什么是操作系统的共享性？是指共享CPU资源？

答：是的。操作系统的特征包括：**并发**：同一时间段系统可以执行多个进程。**共享**：操作系统的资源可以由多个进程共享。**虚拟**：物理上的实体变为若干个逻辑上的对应物。如虚拟机存储器和虚拟机处理器。**异步**。进程执行过程中走走停停，已不可预知的速度执行。

2.同步和异步？

![image-20210129165708326](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210129165708326.png)

## 2. 进程的组织 

本节主要解决进程是由什么组成的概念。

一、进程控制块（PCB）的组成：

![image-20210129153918593](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210129153918593.png)

**进程描述**信息标识进程。

**进程管理和控制信息**用于进程运行中的管理和控制。

**资源分配清单**。进程运行需要的除CPU以外的资源。

**处理机相关信息**。保存进程切换时候的CPU状态

2. 进程组织方式：**链接方式**和**索引方式**。链接方式使用链接表的方式，相同将进程按照不同状态分成不同状态队列。索引方式为不同状态PCB建立索引，相同状态的构成一个索引表。
3. PCB的使用：(a). 进程创建阶段：新建PCB 创建唯一标识符PID。(b). 进程执行：了解进程窗台信息（包含在进程管理和控制信息中。(c). 进程结束。回收PCB （d）整个进程生命周期中。 进程调度前从PCB中查出进程状态和优先级。进程调度时保存CPU状态信息用于恢复现场。进程运行中访问PCB实现同步通信和文件访问。进程暂停时，保存断点的CPU环境(状态信息？)。

二、程序段：能调度到CPU执行的程序的代码段。可以被多个程序共享。

三、数据段：原始定义或者运行过程中产生的数据。



## 3. 进程的状态和转换

一、五种状态：

1. 运行态:进程正在运行，单处理机上只允许单个运行态进程
2. 就绪态: 进程获取除CPU资源以外的其他资源
3. 阻塞态：进程由于等待资源（除CPU资源以外）暂停运行
4. 创建态：进程正在被创建，还未转为就绪态
5. 结束态: 进程正常或因为其他原因终止

二、状态转换：

1. 就绪态->运行态：就绪态的进程被调度，分配CPU资源

2. 运行态->就绪态：运行态的进程时间片用完或者被抢占(非主动)

3.  运行态->阻塞态：运行态的进程请求某一资源或者等待某一事件（如I/O执行）而阻塞。(主动)

4. 阻塞态->就绪态：阻塞中的进程得到资源（如另外的进程完成I/O操作）

   ![image-20210201131223901](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201131223901.png)



## 3. 进程的控制

一、基本概念

1. 进程控制概念：什么是进程控制？进程控制是实现进程间状态转换的方式。进程控制通过**原语**实现
2. 原语：由一段机器指令构成的特殊的程序，由内核供外部程序调用，**不可中断**。

二、进程控制相关原语

	1. 更新PCB中的信息（a. PCB的状态（控制和管理信息中），b. 保存、回复运行环境（处理机相关信息））
 	2. 将PCB插入合适的队列（PCB的组织方式（存在哪个状态队列中））
 	3. 分配、回收资源（更改资源分配清单）

三、相关原语介绍

 1. 进程创建：

    ![image-20210201152911941](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201152911941.png)

 2. 进程终止：

    ![image-20210201152928414](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201152928414.png)

 3. 进程阻塞和唤醒

    ![image-20210201153005710](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201153005710.png)

    ![image-20210201153044239](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201153044239.png)

 4. 进程切换

![image-20210201154018772](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210201154018772.png)



四、引起相关原语执行的事件

1. 进程创建:
2. 进程终止
3. 进程阻塞和唤醒
4. 进程切换：被动：时间片到达或者被高优先级抢占；主动：主动阻塞等待其它进程结果或者释放资源

## 4. 进程通信 (IPC)

一、概念

什么是进程通信：进程之间进行信息的交换

为什么要使用进程通信：进程占用独立的内存地址空间，为了保证安全，一个进程不能直接访问另外一个进程的地址空间。

二、方式：

1. 共享内存 （share memory): 进程共享同一块逻辑内存，允许两个不相关的进程访问同一块内存。访问方式往往采用互斥的方式，例如信号量方式（P/V操作）互斥访问共享空间。
2. 消息传递：进程使用格式化的消息进行通信。消息传递通过发送或者接受原语。共两种方式：1. 直接通信方式 2. 间接通信方式。
3. 管道通信。管道可以理解为内存中一种特殊的文件。管道是半双工的，两个进程只有一个工作。

## 5. 线程和多线程模型

补充链接：https://www.kancloud.cn/hanghanghang/os/116942

一、基本概念

线程：轻量级的进程，是CPU执行的基本单元。线程不拥有系统资源，使用所属进程的资源，只占用少量必须的系统资源，只需保存CPU的一些信息（寄存器，程序计数器，堆栈），线程由线程ID和线程控制块组成。

单元：基本执行单元、CPU独立调度单元，程序最小执行单元

三态：执行态、阻塞态、就绪态。

二、线程与进程的比较

1.为什么有了进程还要提出线程？进程提高了程序的并发度，充分利用系统资源和吞吐量，但是在进程创建销毁中，需要创建释放系统资源，带来额外的时空开销，引入线程是为了减少这部分开销，从而提高操作系统的并发性能。

不同点：

2.调度单位：进程是资源分配的独立单位，线程的CPU调度的独立单位

资源：进程拥有资源的基本单位，线程只拥有少量必要的系统资源（具体指？），线程可以共享所属进程的资源

并发粒度：线程也可以并发执行提高了并发度，增大吞吐量

系统开销：进程系统开销大，包括创建销毁时的系统资源回收，上下文切换的开销（CPU环境）

地址空间及其他资源：进程地址空间独立，线程共享进程资源

进程/线程通信：进程通信：需要同步和互斥手段，线程间通信，直接读写进程数据段（全局变量）

3.线程的实现方式：

用户级线程：用户通过调用线程库编写新线程，线程管理由应用程序完成。如 linux 的 pthread。

内核级线程：线程管理由内核完成，应用程序只有内核级线程的编程接口。

![img](https://box.kancloud.cn/2016-02-16_56c29fbf62c70.jpg)

4.多线程模式

多对一：多个用户级线程对应一个内核级线程

一对一：一个用户级线程对应一个内核级线程 java

多对多：一个用户级线程对应多个内核级线程 go java也有

|        | 优点                                                         | 缺点                                                         |
| ------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 多对一 | 应用程序负责管理线程管理，内核不可见，效率高                 | 当一个线程被阻塞，整个进程被阻塞，只能拥有单个处理机         |
| 一对一 | 并发度高，一个线程阻塞不影响其他线程执行                     | 每创建一个用户级线程必须在内核创建一个内核态线程，创建开销大 |
| 多对多 | 集合了二者的优点，克服了多对一并发度低和一对一创建开销大的缺点。 |                                                              |





注：

1. python 单一时间只能执行一个线程，非传统意义上的多线程，python的主要实现是由cpython完成，cpython 存在一个全局解释器锁，这是为了解决python引用计数对象回收带来的问题。
2. https://zhuanlan.zhihu.com/p/344284185 Linux中的进程线程定义。