## 虚拟内存

### 一、基本概念

1、传统内存管理方式的缺点：

一次性：作业必须一次性装入内存

驻留性：一旦作业被装入内存

2、局部性

时间、空间局部性

3、虚拟内存的定义

装入时只装入即将运行的部分，运行时，将需要的页面换入，内存不足时，将不需要的页面换出

4、虚拟内存技术的特征

多次性、对换性以及虚拟性

5、虚拟内存的实现方式

请求分页、请求分段、请求段页式

6、虚拟内存的容量

最大容量由CPU寻址范围确定

实际由寻址范围和实际内存+外存大小确定



### 二、请求分页管理方式

1、请求分页与基本分页

基本分页：运行时候所有页在内存中，除非使用的覆盖技术

请求分页：调页（所需信息不在内存、从外存）、页面置换

2、页表机制

包括页号、内存块号、

状态位P：用于指示是否已调度内存

访问字段A：用于记录最近被访问的次数，或记录上次访问的时间	

修改位M: 判断在内存中页面是否被修改

外存地址：页面在外存中地址位置



3、缺页中断

​	缺页中断：需要访问的目标页面没有放入内存

​	一条指令执行时可能发生多次中断

​	运行机制：1、发生缺页，产生缺页中断 2、进程进入阻塞队列 3、如果内存有空闲块，为进程分配空闲块，修改页表项。4.内存没有空闲块、由页面置换算法选择页换出，如果该页被修改过，则需要换出外存

4、地址变换：

与基本分页的区别：

1.请求调页 2.页面置换 3.页面调入内存后修改页表中新增的表项。

引入快表的地址变换方式：

1.先检查快表 ，快表命中直接修改快表标志位2. 再检查慢表



### 三、页面置换算法

引入目的原因：若内存空间不足，将内存中不用的页面换出到外存中。

页面的换入换出需要磁盘I/O,页面置换算法需要低缺页率



1.最佳置换算法OPT（optimal) :选择淘汰的页面在以后永不使用，或者在最长时间内不再被访问的页面。缺点：无法实现，以后是否被访问无法预测



2.先进先出置换算法FIFO: 每次选择淘汰的页面是最早进入内存的页面。

实现方案：调入内存的页面组成队列

注：belady异常：内存块数量增大，缺页率不降低反而增大

3.LRU：每次淘汰的页面是最近最久使用的页面

实现方法：访问页表项里面的访问字段，记录了上次访问的时间。

4.时钟置换算法CLOCK（最近未用NRU）:调出最近一段时间内未访问的。

5.改进的CLOCK：调出调出未访问的,是否修改。

最近没访问、没修改的页面

最近没访问、修改过的页面

访问过、没修改

访问过、修改过



### 四、页面分配方法

**驻留集** 定义 分页存储管理中心给进程分配的内存块集合

**页面分配、置换策略分类**：

固定分配、可变分配：驻留集是否可变

局部置换和全局置换：发生缺页时，是从自己的进程中选择一个页面换出，还是从所有进程中选择。

共三类：固定分配局部，可变分配全局，可变分配局部

**调入页面时机**：预调页、请求调页

**调入页面位置**：1.交换区足够大，从外存先放到交换区，从交换区中调入页面。2、对换区不够大、不会修改的数据从文件区调入，修改后的数据调入交换区，需要时从交换区调入。

3、UNIX，第一次从文件区调入，后面调出的都写回交换区，从交换区调入。

**抖动：**页面频繁换入换出、主要原因是分配的物理块数目不够，驻留集小。

**工作集**：指在某段时间间隔里，进程实际访问页面的集合。

驻留集应该大于等于工作集

