## 处理机调度（CPU调度）

一、调度的基本概念

1.什么是调度？调度是按照某种调度算法选择一个进程进行将处理机分配给它，实现进程的并发执行。

2.调度的层次。高级调度（作业调度），中级调度（内存调度），低级调度（**进程调度**）

![image-20210203201744789](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210203201744789.png)

补充：

作业的概念：用户在一次解决或是一个事务处理过程中要求计算机系统所做的工作的集合，它包括用户程序、所需要的数据集控制命令等。作业是由一系列有序的步骤组成的。在执行一个作业可能会运行多个不同的进程。

3.状态模型。![image-20210203202322648](C:\Users\94130\AppData\Roaming\Typora\typora-user-images\image-20210203202322648.png)

挂起在外存，阻塞在内存中。

补充：进程映像的概念：进程在内存空间的分布情况叫进程映像，从低地址到高地址依次：

代码段/只读段：
二进制指令、字符串字面值、具有const属性且被初始化过的全局、静态变量
数据段：被初始化过的全局变量和静态变量
BSS段：没有初始化过的全局变量和静态变量，进程一旦加载成功就会把这段内存清理为零
栈：动态的分配、管理，需要程序员手动操作，从低地址向高地址扩展
堆：非静态的局部变量，包括函数的参数、返回值，从高地址向低地址使用
和堆内存之间存在一段空隙，一方面是为堆和栈的增长预留空间，另一方面存放空间
命令行参数及环境变量表：命令行参数、环境变量

二、进程调度时机、切换过程、方式

1、调度时机

什么时候不能调度？1.处理中断的过程中。2.进程在操作系统的内核程序临界区。3.屏蔽中断的原子操作中，如加锁，中断现场保护。

不能调度怎么办？置系统请求调度标识，等到可以切换调度时再进行。

什么时候需要进程调度？

1. 主动放弃。进程正常终止或异常终止，主动阻塞(等待I/O)
2. 被动放弃。时间片耗尽。有更紧要的事情需要处理，如发送I/O中断。有更高优先级的进程进入就绪队列。

注：

​	1.不能进行调度的原因：和操作系统(内核)工作安全有关。

​	2.内核程序临界区和普通程序临界区。临界区:进程访问临界资源的代码。内核程序临界区：访问操作系统内核中的数据结构或者数据，比如系统时钟？

2、进程切换与过程

切换过程：内核将原进程的现场信息推入当前进程的内核堆栈，更新PCB堆栈指针。

3、进程调度的方式

1.非抢占式：只能由当前进程主动放弃CPU

2.抢占式：可以由操作系统剥夺当前进程的CPU优先级

| 方式     | 优点               | 缺点                 |
| -------- | ------------------ | -------------------- |
| 非抢占式 | 开销小             | 不适用分时、实时系统 |
| 抢占式   | 适用分时、实时系统 | 调度频繁开销大       |

注：分时实时系统概念：分时系统是指在一个系统中多个用户分时地使用同一台计算机； 实时系统是指计算机及时响应外部事件地请求并在规定时限内完成对该事件地处理，控制所有实时外设和实时任务协调一致地运行。



三、调度的基本准则（评价指标）

1. CPU利用率 2. 系统吞吐量 3.周转时间 、带权周转时间以及平均周转时间。
2. 等待时间。
3. 响应时间。
4. 辩证看待所有指标。



|              |                                    |                                    |
| ------------ | ---------------------------------- | ---------------------------------- |
| CPU利用率    | CPU繁忙程度                        | CPU忙碌时间/总时间                 |
| 系统吞吐量   | 单位时间完成作业数量               | 完成作业数量/总时间                |
| 周转时间     | 作业创建和完成之间经过的时间       |                                    |
| 带权周转时间 |                                    | 周转时间/实际运行时间              |
| **等待时间** | 判断用户满意度，衡量调度算法的好坏 | =周转时间-实际运行时间-I/O操作时间 |
| 响应时间     | 判断交互进程是否快速响应           | *                                  |



四、调度算法

作业调度:FCFS,SJF,HRRN(高响应比优先)

进程调度：RR（时间片轮转），优先级调度（适用作业和进程，以及I/O调度）多级反馈队列（）



参考链接：

1.https://www.cnblogs.com/zrtqsk/p/4192091.html 处理机调度笔记

2.https://zhuanlan.zhihu.com/p/144278785 处理机调度文章